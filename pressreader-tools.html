<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="https://em-content.zobj.net/source/google/387/soft-ice-cream_1f366.png" type="image/png">
    <title>PressReader Tools</title>
    <style>
        .token-output, .api-output {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>PressReader Tools</h1>
    <h3>By Kerrawesome</h3>
	<p>The tools provided by Kerrawesome are for educational purposes only.<br>All content displayed is copyright and remains the property of PressReader Inc.</p>

    
    <label for="cid">CID:</label>
    <input type="text" id="cid" name="cid"><br><br>
    
    <label for="issueDate">Issue Date:</label>
    <input type="text" id="issueDate" name="issueDate"><br><br>
    
    <label for="issueSuffix">Issue Suffix (default):</label>
    <input type="text" id="issueSuffix" name="issueSuffix" value="00000000001001"><br><br>
    
    <button id="fetchIssueInfo">Issue Info</button>
    <button id="fetchCatalog">Catalog</button>
    <button id="fetchPages">Fetch Pages</button>
    
    <h2 id="tokenHeader" style="display:none;">Bearer Token</h2>
    <pre id="tokenOutput" class="token-output"></pre>
    
    <h2 id="accessTokenHeader" style="display:none;">Access Tokens</h2>
    <pre id="accessTokenOutput" class="token-output"></pre>
    
    <h2>API Output</h2>
    <pre id="output" class="api-output"></pre>
    
    <div id="scaleContainer" style="display:none;">
        <label for="scaleInput">Scale:</label>
        <input type="number" id="scaleInput" name="scaleInput" value="300" min="1">
    </div>
    
    <div id="linksContainer"></div>

    <script>
        const primaryAccessToken = '_C6WK4jD09pQHoU7WOZG-EBYjytNutTUwP6umGmBEm5I06heGAxOZKSs39GFJrAEsAQ0FSfMX6IiBC4hJPWLMvqX_cmsCDLTdhQIqy8Z-Vs!';
        const secondaryAccessToken = '7lykuJZcSDUnlAxrCh89oET_SIwEwQK3jDRuibpFI8yb2aKadg_W2LSSlf8kO6EDFFBpcejU9ANbN59GiAQlV9sjVMeMTSyFafYCK6beouM!';
        let bearerToken = '';
        let pageUrls = [];

        function clearOutputs() {
            document.getElementById('tokenOutput').textContent = '';
            document.getElementById('accessTokenOutput').textContent = '';
            document.getElementById('output').textContent = '';
            document.getElementById('linksContainer').innerHTML = '';
            document.getElementById('tokenHeader').style.display = 'none';
            document.getElementById('accessTokenHeader').style.display = 'none';
            document.getElementById('scaleContainer').style.display = 'none';
        }

        async function fetchBearerToken() {
            try {
                const response = await fetch('https://www.pressreader.com/authentication/v1/initialize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({})
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();
                document.getElementById('tokenOutput').textContent = JSON.stringify(data, null, 2);
                bearerToken = data.bearerToken;

                if (!bearerToken) {
                    throw new Error('Bearer token is missing in the response');
                }
                document.getElementById('tokenHeader').style.display = 'block';
            } catch (error) {
                document.getElementById('tokenOutput').textContent = `Error: ${error.message}`;
                console.error('Error fetching bearer token:', error);
            }
        }

        async function makeApiRequest(url) {
            const headers = {
                "Accept": "*/*",
                "Authorization": `Bearer ${bearerToken}`
            };

            try {
                const response = await fetch(url, { headers });
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                document.getElementById('output').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('output').textContent = `Error: ${error.message}`;
                console.error('Error fetching API data:', error);
            }
        }

        async function fetchPageKeys(accessToken, cid, issueDate, issueSuffix) {
            const url = `https://ingress.pressreader.com/services/IssueInfo/GetPageKeys?accessToken=${accessToken}&issue=${cid}${issueDate}${issueSuffix}`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                return data.PageKeys;
            } catch (error) {
                console.error('Error fetching page keys:', error);
                return null;
            }
        }

        async function fetchAndDisplayPages(cid, issueDate, issueSuffix, pageKeys) {
            const issueId = `${cid}${issueDate}${issueSuffix}`;
            pageUrls = pageKeys.map((page) => {
                const pageNumber = page.PageNumber;
                const pageKey = page.Key;
                return `https://i.prcdn.co/img?file=${issueId}&page=${pageNumber}&scale=300&ticket=${pageKey}`;
            });

            updatePageLinks();
            document.getElementById('scaleContainer').style.display = 'block';
        }

        function updatePageLinks() {
            const scale = document.getElementById('scaleInput').value;
            const pageLinksHtml = pageUrls.map(url => {
                const updatedUrl = url.replace(/scale=\d+/, `scale=${scale}`);
                return `<a href="${updatedUrl}" target="_blank" class="thumb">${updatedUrl}</a>`;
            }).join('<br>');
            document.getElementById('linksContainer').innerHTML = pageLinksHtml;
        }

        document.getElementById('fetchIssueInfo').addEventListener('click', async () => {
            clearOutputs();
            await fetchBearerToken();
            const cid = document.getElementById('cid').value;
            const issueDate = document.getElementById('issueDate').value;
            if (cid && issueDate) {
                const url = `https://ingress.pressreader.com/services/IssueInfo/GetIssueInfoByCid?cid=${cid}&issueDate=${issueDate}`;
                await makeApiRequest(url);
            } else {
                alert('Please enter both CID and Issue Date');
            }
        });

        document.getElementById('fetchCatalog').addEventListener('click', async () => {
            clearOutputs();
            await fetchBearerToken();
            const url = `https://ingress.pressreader.com/services/catalog`;
            await makeApiRequest(url);
        });

        document.getElementById('fetchPages').addEventListener('click', async () => {
            clearOutputs();
            const cid = document.getElementById('cid').value;
            const issueDate = document.getElementById('issueDate').value;
            const issueSuffix = document.getElementById('issueSuffix').value;

            if (!cid || !issueDate || !issueSuffix) {
                alert('Please enter CID, Issue Date, and Issue Suffix');
                return;
            }

            let pageKeys = await fetchPageKeys(primaryAccessToken, cid, issueDate, issueSuffix);

            if (!pageKeys || pageKeys.length === 0) {
                pageKeys = await fetchPageKeys(secondaryAccessToken, cid, issueDate, issueSuffix);
            }

            if (pageKeys && pageKeys.length > 0) {
                await fetchAndDisplayPages(cid, issueDate, issueSuffix, pageKeys);
            } else {
                alert('Failed to fetch page keys with both primary and secondary access tokens');
            }
        });

        document.getElementById('scaleInput').addEventListener('input', updatePageLinks);
    </script>
</body>
</html>
