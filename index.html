<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bing Chilling Media</title>
    <script>
    function setVh() {
        let vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    window.addEventListener('resize', setVh);
    window.addEventListener('load', setVh);
    setVh();
    </script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: calc(var(--vh, 1vh) * 100);
            background-color: #121212;
            margin: 0;
            font-family: 'Roboto', sans-serif;
            color: #ffffff;
            flex-direction: column;
        }

        .hidden {
            display: none;
        }

        .prompt-box {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            text-align: center;
            width: 90%;
            max-width: 400px;
            position: relative;
        }

        input, textarea, select {
            width: calc(100% - 20px);
            margin-top: 10px;
            margin-bottom: 10px;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #333;
            border-radius: 5px;
            background-color: #2e2e2e;
            color: #ffffff;
            box-sizing: border-box;
        }

        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #6200ee;
            color: #ffffff;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #3700b3;
        }

        img {
            max-width: 60%;
            border-radius: 10px;
            margin-bottom: 5px;
        }

        .suggestions {
            position: absolute;
            background-color: #1e1e1e;
            border: 1px solid #333;
            border-radius: 5px;
            width: calc(100% - 20px);
            max-width: 400px;
            z-index: 1000;
            margin-top: -5px;
        }

        .suggestion-item {
            padding: 10px;
            cursor: pointer;
        }

        .suggestion-item:hover {
            background-color: #333;
        }

        .video-container {
            width: 90%;
            max-width: 800px;
            margin-top: 20px;
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 10px;
        }
    </style>
    <script>
        let debounceTimer;

        function debounce(callback, delay) {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(callback, delay);
        }

        function createInitialPrompt() {
            const promptBox = document.createElement('div');
            promptBox.classList.add('prompt-box');
            promptBox.id = 'initial-prompt-box';
            
            const headingText = document.createElement('h1');
            headingText.textContent = 'Bing Chilling Media';
            headingText.style.fontSize = '30px';
            headingText.style.marginBottom = '20px';
            promptBox.appendChild(headingText);

            const promptText = document.createElement('p');
            promptText.textContent = 'Choose your movie or TV show.';
            promptBox.appendChild(promptText);

            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'tmdb-query';
            input.addEventListener('input', function() {
                debounce(searchSuggestions, 300);
            });
            promptBox.appendChild(input);

            const suggestionsBox = document.createElement('div');
            suggestionsBox.id = 'suggestions-box';
            suggestionsBox.classList.add('suggestions');
            promptBox.appendChild(suggestionsBox);

            const searchButton = document.createElement('button');
            searchButton.textContent = 'Search on TMDB';
            searchButton.onclick = searchTMDB;
            promptBox.appendChild(searchButton);

            document.body.appendChild(promptBox);

            document.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' && document.getElementById('confirmation-prompt-box')) {
                    document.getElementById('ok-button').click();
                }
            });
        }

        async function searchSuggestions() {
            var apiKey = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0OTNiNWI3ODhlM2U0NDM4Y2Y2ZmY0ODI3NTJjN2Q2MSIsIm5iZiI6MTcxOTMxMjU2OC41NTY3MDEsInN1YiI6IjY2N2E5ZTczOTdkMDQ3YWNlNTNiNWU2MiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.TRZDf_GmWas5rFhq-6wzT7RUJOCxvCUFf6hT-Jd9iIM';
            var query = document.getElementById('tmdb-query').value;
            if (query) {
                try {
                    let response = await fetch('https://api.themoviedb.org/3/search/multi?query=' + encodeURIComponent(query) + '&include_adult=false&language=en-US&page=1', {
                        method: 'GET',
                        headers: {
                            'Authorization': 'Bearer ' + apiKey,
                            'Accept': 'application/json'
                        }
                    });
                    let data = await response.json();
                    displaySuggestions(data.results);
                } catch (error) {
                    console.error('Error fetching data from TMDB: ' + error);
                }
            } else {
                clearSuggestions();
            }
        }

        function displaySuggestions(results) {
            const suggestionsBox = document.getElementById('suggestions-box');
            suggestionsBox.innerHTML = '';
            if (results && results.length > 0) {
                const uniqueResults = [];
                const seenTitles = new Set();

                results.forEach(result => {
                    const name = result.title || result.name;
                    const year = (result.release_date || result.first_air_date || '').split('-')[0];
                    const uniqueKey = `${name}-${year}`;

                    if (!seenTitles.has(uniqueKey) && name && year) {
                        uniqueResults.push({ name, year, result });
                        seenTitles.add(uniqueKey);
                    }
                });

                uniqueResults.forEach(({ name, year, result }) => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.classList.add('suggestion-item');
                    suggestionItem.textContent = `${name} (${year})`;
                    suggestionItem.onclick = function() {
                        document.getElementById('tmdb-query').value = name;
                        clearSuggestions();
                    };
                    suggestionsBox.appendChild(suggestionItem);
                });
            }
        }

        function clearSuggestions() {
            const suggestionsBox = document.getElementById('suggestions-box');
            suggestionsBox.innerHTML = '';
        }

        async function searchTMDB() {
            var apiKey = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0OTNiNWI3ODhlM2U0NDM4Y2Y2ZmY0ODI3NTJjN2Q2MSIsIm5iZiI6MTcxOTMxMjU2OC41NTY3MDEsInN1YiI6IjY2N2E5ZTczOTdkMDQ3YWNlNTNiNWU2MiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.TRZDf_GmWas5rFhq-6wzT7RUJOCxvCUFf6hT-Jd9iIM';
            var query = document.getElementById('tmdb-query').value;
            if (query) {
                try {
                    let response = await fetch('https://api.themoviedb.org/3/search/multi?query=' + encodeURIComponent(query) + '&include_adult=false&language=en-US&page=1', {
                        method: 'GET',
                        headers: {
                            'Authorization': 'Bearer ' + apiKey,
                            'Accept': 'application/json'
                        }
                    });
                    let data = await response.json();
                    let result = data.results && data.results[0];
                    if (result) {
                        var id = result.id;
                        var name = result.title || result.name;
                        var year = (result.release_date || result.first_air_date || '').split('-')[0];
                        var posterPath = result.poster_path ? 'https://image.tmdb.org/t/p/w500' + result.poster_path : null;
                        var confirmationMessage =  name + ' (' + (year ? year : 'Unknown Year') + ')';
                        showConfirmationPrompt(confirmationMessage, id, posterPath, result.media_type);
                    } else {
                        alert('No results found.');
                    }
                } catch (error) {
                    alert('Error fetching data from TMDB: ' + error);
                }
            }
        }

        function showConfirmationPrompt(message, id, posterPath, mediaType) {
            document.getElementById('initial-prompt-box').classList.add('hidden');

            const promptBox = document.createElement('div');
            promptBox.classList.add('prompt-box');
            promptBox.id = 'confirmation-prompt-box';
            
            const headingText = document.createElement('h2');
            headingText.textContent = 'You selected';
            headingText.style.fontSize = '30px';
            headingText.style.marginBottom = '10px';
            headingText.style.whiteSpace = 'pre-line';
            promptBox.appendChild(headingText);
            
            const footerText = document.createElement('p');
            footerText.textContent = 'TMDB ID: ' + id;
            footerText.style.marginBottom = '20px';
            promptBox.appendChild(footerText);

            if (posterPath) {
                const posterImage = document.createElement('img');
                posterImage.src = posterPath;
                promptBox.appendChild(posterImage);
            }

            const promptText = document.createElement('p');
            promptText.textContent = message;
            promptText.style.marginBottom = '20px';
            promptText.style.whiteSpace = 'pre-line';
            promptBox.appendChild(promptText);

            const confirmButton = document.createElement('button');
            confirmButton.textContent = 'OK';
            confirmButton.id = 'ok-button';
            confirmButton.onclick = function() {
                if (mediaType === 'movie') {
                    const movieUrl = `https://vidsrc.pro/embed/movie/${id}`;
                    showVideo(movieUrl);
                } else if (mediaType === 'tv') {
                    fetchSeasons(id);
                }
            };
            promptBox.appendChild(confirmButton);

            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'Cancel';
            cancelButton.onclick = function() {
                promptBox.remove();
                document.getElementById('initial-prompt-box').classList.remove('hidden');
            };
            promptBox.appendChild(cancelButton);

            document.body.appendChild(promptBox);
        }

        async function fetchSeasons(tvId) {
            var apiKey = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0OTNiNWI3ODhlM2U0NDM4Y2Y2ZmY0ODI3NTJjN2Q2MSIsIm5iZiI6MTcxOTMxMjU2OC41NTY3MDEsInN1YiI6IjY2N2E5ZTczOTdkMDQ3YWNlNTNiNWU2MiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.TRZDf_GmWas5rFhq-6wzT7RUJOCxvCUFf6hT-Jd9iIM';
            try {
                let response = await fetch(`https://api.themoviedb.org/3/tv/${tvId}?language=en-US`, {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + apiKey,
                        'Accept': 'application/json'
                    }
                });
                let data = await response.json();
                showSeasonsPrompt(tvId, data.seasons);
            } catch (error) {
                alert('Error fetching seasons data from TMDB: ' + error);
            }
        }

        function showSeasonsPrompt(tvId, seasons) {
            document.getElementById('confirmation-prompt-box').remove();

            const promptBox = document.createElement('div');
            promptBox.classList.add('prompt-box');
            promptBox.id = 'seasons-prompt-box';

            const promptText = document.createElement('p');
            promptText.textContent = 'Select a season:';
            promptBox.appendChild(promptText);

            const select = document.createElement('select');
            select.id = 'season-select';
            seasons.forEach(season => {
                const option = document.createElement('option');
                option.value = season.season_number;
                option.textContent = season.name;
                select.appendChild(option);
            });
            promptBox.appendChild(select);

            const confirmButton = document.createElement('button');
            confirmButton.textContent = 'OK';
            confirmButton.onclick = function() {
                const seasonNumber = select.value;
                fetchEpisodes(tvId, seasonNumber);
            };
            promptBox.appendChild(confirmButton);

            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'Cancel';
            cancelButton.onclick = function() {
                promptBox.remove();
                document.getElementById('initial-prompt-box').classList.remove('hidden');
            };
            promptBox.appendChild(cancelButton);

            document.body.appendChild(promptBox);
        }

        async function fetchEpisodes(tvId, seasonNumber) {
            var apiKey = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0OTNiNWI3ODhlM2U0NDM4Y2Y2ZmY0ODI3NTJjN2Q2MSIsIm5iZiI6MTcxOTMxMjU2OC41NTY3MDEsInN1YiI6IjY2N2E5ZTczOTdkMDQ3YWNlNTNiNWU2MiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.TRZDf_GmWas5rFhq-6wzT7RUJOCxvCUFf6hT-Jd9iIM';
            try {
                let response = await fetch(`https://api.themoviedb.org/3/tv/${tvId}/season/${seasonNumber}?language=en-US`, {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + apiKey,
                        'Accept': 'application/json'
                    }
                });
                let data = await response.json();
                showEpisodesPrompt(tvId, seasonNumber, data.episodes);
            } catch (error) {
                alert('Error fetching episodes data from TMDB: ' + error);
            }
        }

        function showEpisodesPrompt(tvId, seasonNumber, episodes) {
            document.getElementById('seasons-prompt-box').remove();

            const promptBox = document.createElement('div');
            promptBox.classList.add('prompt-box');
            promptBox.id = 'episodes-prompt-box';

            const promptText = document.createElement('p');
            promptText.textContent = 'Select an episode:';
            promptBox.appendChild(promptText);

            const select = document.createElement('select');
            select.id = 'episode-select';
            episodes.forEach(episode => {
                const option = document.createElement('option');
                option.value = episode.episode_number;
                const episodeName = episode.name !== `Episode ${episode.episode_number}` ? episode.name : '';
                option.textContent = `Episode ${episode.episode_number}${episodeName ? ' - ' + episodeName : ''}`;
                select.appendChild(option);
            });
            promptBox.appendChild(select);

            const confirmButton = document.createElement('button');
            confirmButton.textContent = 'OK';
            confirmButton.onclick = function() {
                const episodeNumber = select.value;
                const tvUrl = `https://vidsrc.pro/embed/tv/${tvId}/${seasonNumber}/${episodeNumber}`;
                showVideo(tvUrl);
            };
            promptBox.appendChild(confirmButton);

            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'Cancel';
            cancelButton.onclick = function() {
                promptBox.remove();
                document.getElementById('initial-prompt-box').classList.remove('hidden');
            };
            promptBox.appendChild(cancelButton);

            document.body.appendChild(promptBox);
        }

        function showVideo(url) {
            document.body.innerHTML = '';

            const videoContainer = document.createElement('div');
            videoContainer.classList.add('video-container');

            const iframe = document.createElement('iframe');
            iframe.src = url;
            iframe.sandbox = "allow-scripts allow-same-origin";
            iframe.allowFullscreen = true;

            videoContainer.appendChild(iframe);
            document.body.appendChild(videoContainer);
        }

        window.onload = createInitialPrompt;
    </script>
</head>
<body>
</body>
</html>
