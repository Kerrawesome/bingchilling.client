<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bing Chilling Media</title>
    <script>
    function setVh() {
        let vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    window.addEventListener('resize', setVh);
    window.addEventListener('load', setVh);
    setVh();
    </script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: calc(var(--vh, 1vh) * 100);
            background-color: #121212;
            margin: 0;
            font-family: 'Roboto', sans-serif;
            color: #ffffff;
			overflow-y: auto;
        }

        .hidden {
            display: none;
        }

        .prompt-box {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            text-align: center;
            max-width: 90%;
			max-height: 90%;

            position: relative;
            margin-bottom: 20px;
        }

		.prompt-box iframe {
			width: 100%;
			height: calc(100vh - 100px);
			border: none;
			border-radius: 5px;
		}

        input, textarea, select {
            width: calc(100% - 20px);
            margin-top: 10px;
            margin-bottom: 10px;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #333;
            border-radius: 5px;
            background-color: #2e2e2e;
            color: #ffffff;
            box-sizing: border-box;
        }

        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #6200ee;
            color: #ffffff;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #3700b3;
        }

        img {
            max-width: 50%;
            border-radius: 10px;
            margin-bottom: 5px;
        }

        .suggestions {
            position: absolute;
            background-color: #1e1e1e;
            border: 1px solid #333;
            border-radius: 5px;
            width: 100%;
            max-width: 350px;
            z-index: 1000;
            margin-top: 5px;
            left: 50%;
            transform: translateX(-50%);
        }

        .suggestion-item {
            padding: 10px;
			font-size: 15px;
            cursor: pointer;
        }

        .suggestion-item:hover {
            background-color: #333;
        }

        .footer {
            margin-top: 20px;
            font-size: 14px;
            color: #bbb;
			text-align: center;
        }

        .footer a {
            color: #6200ee;
            text-decoration: none;
        }
    </style>

    <script>
	let debounceTimer;
        let currentPrompt;

        function debounce(callback, delay) {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(callback, delay);
        }

        function createInitialPrompt() {
            const promptBox = document.createElement('div');
            promptBox.classList.add('prompt-box');
            promptBox.id = 'initial-prompt-box';

            currentPrompt = 'initial-prompt-box';

            const headingText = document.createElement('h1');
            headingText.textContent = 'Bing Chilling Media';
            headingText.style.fontSize = '30px';
            headingText.style.marginBottom = '20px';
            headingText.style.color = '#ffffff';
            promptBox.appendChild(headingText);

            const promptText = document.createElement('p');
            promptText.textContent = 'Choose your movie or TV show.';
            promptText.style.color = '#ff9800';
            promptBox.appendChild(promptText);

            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'tmdb-query';
			input.placeholder = 'Search 🔍';
            input.addEventListener('input', function() {
                debounce(searchSuggestions, 300);
            });
            promptBox.appendChild(input);

            const suggestionsBox = document.createElement('div');
            suggestionsBox.id = 'suggestions-box';
            suggestionsBox.classList.add('suggestions');
            promptBox.appendChild(suggestionsBox);
			
			const footer = createFooter();
            promptBox.appendChild(footer);

            document.body.appendChild(promptBox);

            document.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' && currentPrompt === 'initial-prompt-box') {
                    searchTMDB();
                }
            });
        }

        async function searchSuggestions() {
            var apiKey = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI0OTNiNWI3ODhlM2U0NDM4Y2Y2ZmY0ODI3NTJjN2Q2MSIsIm5iZiI6MTcxOTMxMjU2OC41NTY3MDEsInN1YiI6IjY2N2E5ZTczOTdkMDQ3YWNlNTNiNWU2MiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.TRZDf_GmWas5rFhq-6wzT7RUJOCxvCUFf6hT-Jd9iIM';
            var query = document.getElementById('tmdb-query').value;
            if (query) {
                try {
                    let response = await fetch('https://api.themoviedb.org/3/search/multi?query=' + encodeURIComponent(query) + '&include_adult=false&language=en-US&page=1', {
                        method: 'GET',
                        headers: {
                            'Authorization': 'Bearer ' + apiKey,
                            'Accept': 'application/json'
                        }
                    });
                    let data = await response.json();
                    displaySuggestions(data.results);
                } catch (error) {
                    console.error('Error fetching data from TMDB: ' + error);
                }
            } else {
                clearSuggestions();
            }
        }

        function displaySuggestions(results) {
            const suggestionsBox = document.getElementById('suggestions-box');
            suggestionsBox.innerHTML = '';
            if (results && results.length > 0) {
                const uniqueResults = [];
                const seenTitles = new Set();

                results.forEach(result => {
                    const name = result.title || result.name;
                    const year = (result.release_date || result.first_air_date || '').split('-')[0];
                    const uniqueKey = `${name}-${year}`;

                    if (!seenTitles.has(uniqueKey) && name && year) {
                        uniqueResults.push({ name, year, result });
                        seenTitles.add(uniqueKey);
                    }
                });

                uniqueResults.forEach(({ name, year, result }) => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.classList.add('suggestion-item');
                    suggestionItem.textContent = `${name} (${year})`;
                    suggestionItem.onclick = function() {
                        document.getElementById('tmdb-query').value = name;
                        clearSuggestions();
                        searchTMDB(result);
                    };
                    suggestionsBox.appendChild(suggestionItem);
                });
            }
        }

        function clearSuggestions() {
            const suggestionsBox = document.getElementById('suggestions-box');
            suggestionsBox.innerHTML = '';
        }

        async function searchTMDB(result) {
            if (result) {
                var id = result.id;
                var name = result.title || result.name;
                var year = (result.release_date || result.first_air_date || '').split('-')[0];
                var posterPath = result.poster_path ? 'https://image.tmdb.org/t/p/w500' + result.poster_path : null;
                var confirmationMessage = name + ' (' + (year ? year : 'Unknown Year') + ')';
                showConfirmationPrompt(confirmationMessage, id, posterPath, result.media_type);
            }
        }

        function showConfirmationPrompt(message, id, posterPath, mediaType) {
            document.getElementById('initial-prompt-box').classList.add('hidden');

            const promptBox = document.createElement('div');
            promptBox.classList.add('prompt-box');
            promptBox.id = 'confirmation-prompt-box';

            currentPrompt = 'confirmation-prompt-box';

            const headingText = document.createElement('h2');
            headingText.textContent = 'Your selection is';
            headingText.style.fontSize = '30px';
            headingText.style.marginBottom = '10px';
            headingText.style.whiteSpace = 'pre-line';
            promptBox.appendChild(headingText);

            const footerText = document.createElement('p');
            footerText.textContent = 'TMDB ID: ' + id;
            footerText.style.marginBottom = '20px';
            promptBox.appendChild(footerText);

            if (posterPath) {
                const posterImage = document.createElement('img');
                posterImage.src = posterPath;
                promptBox.appendChild(posterImage);
            }

            const promptText = document.createElement('p');
            promptText.textContent = message;
            promptText.style.marginBottom = '20px';
            promptText.style.whiteSpace = 'pre-line';
            promptBox.appendChild(promptText);

            const confirmButton = document.createElement('button');
            confirmButton.textContent = 'OK';
            confirmButton.id = 'ok-button';
            confirmButton.onclick = function() {
                showCopyPrompt(id);
            };
            promptBox.appendChild(confirmButton);

            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'Back';
            cancelButton.onclick = function() {
                promptBox.remove();
                document.getElementById('initial-prompt-box').classList.remove('hidden');
            };
            promptBox.appendChild(cancelButton);

            document.body.appendChild(promptBox);
			
			document.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' && currentPrompt === 'confirmation-prompt-box') {
                    confirmButton.click();
                }
            });
        }

        function showCopyPrompt(id) {
            document.getElementById('confirmation-prompt-box').remove();

            const promptBox = document.createElement('div');
            promptBox.classList.add('prompt-box');
            promptBox.id = 'copy-prompt-box';

            const promptText = document.createElement('p');
            promptText.textContent = 'Copy the TMDB ID, then launch the video API.';
            promptBox.appendChild(promptText);

            const textArea = document.createElement('textarea');
            textArea.id = 'tmdb-id';
            textArea.value = id;
            textArea.readOnly = true;
            textArea.style.fontSize = '30px';
            promptBox.appendChild(textArea);

            const copyButton = document.createElement('button');
            copyButton.textContent = 'Copy to Clipboard';
            copyButton.onclick = function() {
                textArea.select();
                document.execCommand('copy');
            };
            promptBox.appendChild(copyButton);

            const launchButton = document.createElement('button');
            launchButton.textContent = 'Launch VidSrc API';
            launchButton.onclick = function() {
                showEmbeddedVidSrc();
            };
            promptBox.appendChild(launchButton);

            const footer = createFooter();
            promptBox.appendChild(footer);

            document.body.appendChild(promptBox);
        }

        function createFooter() {
            const footer = document.createElement('div');
            footer.classList.add('footer');
            footer.innerHTML = 'Made with ❤️ by Kerrawesome and ChatGPT<br>\n<strong>Disclaimer:</strong> Bing Chilling Media does not host any files; it only displays content from third-party providers.';
			footer.style.whiteSpace = 'pre-line';
			footer.style.textAlign = 'center';
            return footer;
        }

        function showEmbeddedVidSrc() {
            document.getElementById('copy-prompt-box').remove();

            const promptBox = document.createElement('div');
            promptBox.classList.add('prompt-box');
            promptBox.id = 'embed-prompt-box';

            const iframe = document.createElement('iframe');
            iframe.src = 'https://vidsrc.pro/';
            iframe.style.width = 'calc(100vh + 300px)';
            iframe.style.height = 'calc(100vh - 200px)';
            iframe.style.border = 'none';
            iframe.style.borderRadius = '10px';
			iframe.allowFullscreen = true;
            promptBox.appendChild(iframe);

            const footer = createFooter();
            promptBox.appendChild(footer);

            document.body.appendChild(promptBox);
        }

        window.onload = function() {
            createInitialPrompt();

        };
    </script>
</head>
<body>
</body>
</html>
